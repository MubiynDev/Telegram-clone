let DATA = {

    chats: [
        {
            id: 1,
            first_name: "Muhammed",
            last_name: "Ali",
            avatar: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQVEjoPV0LSFFVpaHXtFwdDGOczYXCIwZmi-Q&usqp=CAU",
            bio: "Believe yourself!",
            phone_number: "+44 777 777 77 77",
            user_name: "@Ali_701",
            groups_common: 4,
            shared_links: 15,
            shared_files: 1,
            shared_photos: 20,
            shared_voice: 15,
            activity: "online",
            messages: [
                {
                    id: 1,
                    is_from_me: false,
                    text: "Hello",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 2,
                    is_from_me: true,
                    text: "Hi",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 3,
                    is_from_me: false,
                    text: "How are you ?",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 4,
                    is_from_me: true,
                    text: " and you ?",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
            ]
        },


        {
            id: 2,
            first_name: "Polat",
            last_name: "Alemdar",
            avatar: "http://sun9-57.userapi.com/s/v1/if2/KZb3_VXtPmh3OdI0o4GFsN8rGwcgCxIz6WmHtqUkeLQVWy3Std7NkeyBx5w2a6HuRxgiyeSP6J2XyUK9alGsln5i.jpg?size=400x400&quality=96&crop=43,0,426,426&ava=1",
            bio: "Sonunu dusenen kahraman olamaz!",
            phone_number: "+44 777 777 77 77",
            user_name: "@can_polat",
            groups_common: 4,
            shared_links: 15,
            shared_files: 1,
            shared_photos: 20,
            shared_voice: 15,
            activity: "last seen recently",
            messages: [
                {
                    id: 1,
                    is_from_me: false,
                    text: "selamun aleykum",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 2,
                    is_from_me: true,
                    text: "aleykum selam ne haber pusu devami ne zaman?",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 3,
                    is_from_me: false,
                    text: "bitti dizi yaslandik artik",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 4,
                    is_from_me: true,
                    text: "ok",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
            ]
        },


        {
            id: 3,
            first_name: "Tim",
            last_name: "Aroon",
            avatar: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSTa31xKmnI6rYS9nSNXJNOewF7o1E49L6r_Q&usqp=CAU",
            bio: "s.o.s",
            phone_number: "+44 777 777 77 77",
            user_name: "@ta_777",
            groups_common: 4,
            shared_links: 15,
            shared_files: 1,
            shared_photos: 20,
            shared_voice: 15,
            activity: "Last seen 1 hour ago",
            messages: [
                {
                    id: 1,
                    is_from_me: true,
                    text: "Hello",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 2,
                    is_from_me: false,
                    text: "Hi",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 3,
                    is_from_me: true,
                    text: "How are you ?",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 4,
                    is_from_me: false,
                    text: "im fine thank you",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
            ]
        },


        {
            id: 4,
            first_name: "Alex",
            last_name: "77",
            avatar: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQNfvr-e3dE--_v7q7bQFX3ZEn2aSJtkri3pg&usqp=CAU",
            bio: "Believe yourself!",
            phone_number: "+44 777 777 77 77",
            user_name: "@Alexxxx01",
            groups_common: 4,
            shared_links: 15,
            shared_files: 1,
            shared_photos: 20,
            shared_voice: 15,
            activity: "online",
            messages: [
                {
                    id: 1,
                    is_from_me: false,
                    text: "Hello",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 2,
                    is_from_me: true,
                    text: "Hi",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 3,
                    is_from_me: false,
                    text: "How are you ?",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
                {
                    id: 4,
                    is_from_me: true,
                    text: "whats up bro?",
                    time: new Date(2022, 6, 2, 11, 10, 05).getTime()
                },
            ]
        },


        {
            id: 5,
            first_name: "Alisher",
            last_name: "07",
            avatar: "https://broncolor.swiss/assets/img/Stories/Inspiration/Daniel-Radcliffe/_contentWithShareBar23/DANIEL-RADCLIFFE-featured.jpg",
            bio: "lorem ipsum dolor sit",
            phone_number: "+998 77 234 47 77",
            user_name: "@Alisher_07",
            groups_common: 4,
            shared_links: 15,
            shared_files: 1,
            shared_photos: 20,
            shared_voice: 15,
            activity: "last seen 6 hours ago",
            messages: [
                {
                    id: 1,
                    is_from_me: false,
                    text: "nimagap",
                    time: new Date(2022, 6, 1, 11, 10, 05).getTime()
                },
                {
                    id: 2,
                    is_from_me: true,
                    text: "tinchli ozindachi",
                    time: new Date(2022, 6, 1, 11, 10, 05).getTime()
                },
                {
                    id: 3,
                    is_from_me: false,
                    text: "tinch",
                    time: new Date(2022, 6, 1, 11, 10, 05).getTime()
                },
                
            ]
        },



        {
            id: 6,
            first_name: "Mubiyn",
            last_name: "Sofiyyulloh",
            avatar: "https://mubiyndev.github.io/images/photo_2022-01-24_14-55-04.jpg",
            bio: "",
            phone_number: "+998 88 831 00 09",
            user_name: "@Binsofiyyulloh",
            groups_common: 4,
            shared_links: 15,
            shared_files: 1,
            shared_photos: 20,
            shared_voice: 15,
            activity: "",
            messages: [
                {
                    id: 1,
                    is_from_me: true,
                    text: "This is Saved Messages section. You can use it for your own private cloud. Enjoy Telegram :)",
                    time: new Date(2022, 6, 1, 11, 10, 05).getTime()
                },
                
                
            ]
        },


        


        

        
    ]
}

!localStorage.getItem("DATA") && localStorage.setItem("DATA", JSON.stringify(DATA));

let weekDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

const renderLists = () => {
   DATA.chats.forEach((item, index) => {
       let newList = `
       <li class="chats-item" id="${item.id}" userName="${item.user_name}">
                    <img src="${item.avatar}"  alt="" class="avatar rounded-circle float-start me-2">
                    <div class="chat-container d-flex align-items-center justify-content-between">
                        <h5 class="user-name">${item.first_name + ' ' + item.last_name}</h5>
                        <span class="${item.messages[item.messages.length-1].is_from_me ? "bi bi-check-all ms-auto me-1 text-info" : ""}"></span>
                        <span class="time">${weekDays[new Date(item.messages[item.messages.length - 1].time).getDay()]}</span>
                        
                    </div>
                    <div class="chat-item-container d-flex">
                    <p class="message text-truncate" style="max-width: 250px;">${item.messages[item.messages.length-1].text}</p>
                    <span class="${!item.messages[item.messages.length-1].is_from_me ? "unread-message ms-auto badge bg-info" : "hidden"}">+1</span>
                    </div>
                </li>
       `
       document.querySelector('.chats-ul').innerHTML += newList;


   })
   
}
renderLists()

let newChats = document.querySelectorAll('.chats-item');
let inputMessage = document.querySelector('#send-message');

let activeChatID;
let targetChatID;






  
const renderChats = () => {
    

    newChats.forEach(el => {
        let parsedData = JSON.parse(localStorage.getItem("DATA"))

        el.addEventListener('click', e => {
            // let elID = el.id - 0;
            let activeChatID = e.currentTarget.id - 0;
           
            parsedData.chats.forEach(i => {
                
                    if(activeChatID === i.id && i){


                        
                    
                      document.querySelector('.chat-info').setAttribute("id", i.id)
                      document.querySelector('.nav-avatar').src = `${i.avatar}`
                      document.querySelector('.username').innerHTML = `${i.first_name} ${i.last_name}`  
                      document.querySelector('.last-seen').innerHTML = `${i.activity}`
                      
                      document.querySelector('.chats-content-body').innerHTML = ""

                      i.messages.forEach(message => {
                        
                          
                        document.querySelector('.chats-content-body').innerHTML += `
                        <div class="${message.is_from_me ? "from-me" : "messages" }">
                            <p class="message-item"> ${message.text}
                               <div class="msg-info ">
                                 <span class="${message.is_from_me ? "is-checked bi bi-check-all" : "is-checked "}"></span>
                                 <span class="send-time">${new Date(message.time).getHours()}:${new Date(message.time).getMinutes()}</span>
                               </div>
                            </p>
                        </div>
                        
                        
                        
                        `  


                      })
                
                      document.querySelector('.chats-content-footer').classList.remove('hidden')
                      
                      inputMessage.focus()
                      
                      inputMessage.addEventListener('keyup', (e) => {
                      
                        let value = e.target.value.trim();
                             if(value){
                                 document.querySelector('.sender-icon').classList.remove("bi-mic-fill")
                                 document.querySelector('.sender-icon').classList.add("bi-send-fill")
                             }else{
                                document.querySelector('.sender-icon').classList.remove("bi-send-fill")
                                document.querySelector('.sender-icon').classList.add("bi-mic-fill")
                      
                             }
                      })                  

                }
            })
           
        })       

    })
    
    
}

renderChats()


let addNewMessage = () => {
    let parsedData = JSON.parse(localStorage.getItem("DATA"))

    
         newChats.forEach(li => {
             li.addEventListener("click", e => {
                 targetChatID = e.currentTarget.getAttribute('id') - 0;
                 targetUsername = e.currentTarget.getAttribute("userName")
                 activeChatID = parsedData.chats.find(i => i.id === targetChatID - 0).id
                 console.log(targetChatID,activeChatID, targetUsername)
                 document.querySelector('.sender-icon').addEventListener("click", () => {
                   
                        if(activeChatID === targetChatID){
                            parsedData.chats.forEach(chat => {
                                
                           if(chat.user_name === targetUsername){
                               if(inputMessage.value){
                                console.log(true)
                                chat.messages.push({
                                    id: chat.messages[chat.messages.length -1].id + 1,
                                    is_from_me: true,
                                    text: inputMessage.value,
                                    time: new Date().getTime()
                                })
    
                                document.querySelector('.chats-content-body').innerHTML += `
                                 <div class="from-me">
                                     <p class="message-item"> ${chat.messages[chat.messages.length-1].text}
                                        <div class="msg-info ">
                                          <span class="is-checked bi bi-check-all"></span>
                                          <span class="send-time">${new Date(chat.messages[chat.messages.length-1].time).getHours()}:${new Date(chat.messages[chat.messages.length-1].time).getMinutes()}</span>
                                        </div>
                                     </p>
                                 </div>
                                
                                   ` 
                                   renderChats()
                               }
                           

                           } 
                          
                        })
                        }
                    


                    inputMessage.value = ""
                    inputMessage.focus()
                    document.querySelector('.sender-icon').classList.remove("bi-send-fill")
                    document.querySelector('.sender-icon').classList.add("bi-mic-fill")
                    localStorage.setItem("DATA", JSON.stringify(parsedData))

                 })
             })
         })

         console.log(parsedData.chats)

         

    
}



addNewMessage()


//------------------------ modals ------------------

let showSidebar = () => {
    document.querySelector('.menu').addEventListener('click', (e) => {
        document.querySelector('.sidebar-modal').style.display = "block"
    
       window.addEventListener('click', e => {
           if(e.target.classList == 'sidebar-modal'){
            document.querySelector('.sidebar-modal').style.display = "none"
           }
       })
       document.querySelector('.sidebar-img').src = `${DATA.chats[DATA.chats.length-1].avatar}`
       document.querySelector('.myname').innerHTML = `${DATA.chats[DATA.chats.length-1].first_name} ${DATA.chats[DATA.chats.length-1].last_name}`
       document.querySelector('.mynumber').innerHTML = `${DATA.chats[DATA.chats.length-1].phone_number}`
    
    
    
    })
}
showSidebar()

let showUserInfo = () => {

    document.querySelector('.chat-info').addEventListener('click', e => {
        let parsedData = JSON.parse(localStorage.getItem("DATA"))
    
       
    
        parsedData.chats.forEach(chat => {
            
            if(chat.id === e.currentTarget.id - 0 && e.currentTarget) {
                
                document.querySelector('.user-info-modal__content').innerHTML = `
                
                <div class="chat-info d-flex align-items-center mb-3 px-4">
                <img src="${chat.avatar}"  alt="" class="avatar avatar2 nav-avatar rounded-circle float-start me-4">
               <div class="info-wrapper d-flex flex-column">
                <h5 class="username m-0">${chat.first_name} ${chat.last_name}</h5>
                <small class="last-seen text-info">${chat.activity}</small>
                <span class="bi bi-x"></span>
               </div>
            </div> 
            
            <div class="bio-wrapper">
                <h7 class="mobile">${chat.phone_number}</h7>
                <p class="mb-2 text-secondary">Mobile</p>
                <h7 class="bio">${chat.bio}</h7>
                <p class="mb-2 text-secondary">Bio</p>
                <h7 class="username-modal">${chat.user_name}</h7>
                <p class="text-secondary">Username</p>
            </div>
    
            <div class="sharing-wrapper">
                <ul class="m-0 p-0">
                    <li class="shared-items "><i class="bi bi-folder2"></i> ${chat.shared_files} Files</li>
                    <li class="shared-items "><i class="bi bi-image"></i> ${chat.shared_photos} Photos</li>
                    <li class="shared-items "><i class="bi bi-link"></i> ${chat.shared_links} Links</li>
                    <li class="shared-items"><i class=" bi bi-mic"></i> ${chat.shared_voice} Voice</li>
                    
                </ul>
            </div>
    
            <div class="edition-wrapper">
                <ul class="m-0 p-0">
                    <li class="edition-items"><i class=" bi bi-pencil"></i> Edit Contact</li>
                    <li class="edition-items"><i class=" bi bi-trash"></i> Delete Contact</li>
                    <li class="edition-items "><i class="bi bi-shield-slash"></i> Block User</li>
                </ul>
            </div>
        </div>
                
                `        
                
        document.querySelector('.user-info-modal').style.display = "flex"
    
            document.querySelector('.bi-x').addEventListener('click', () => {
                
            document.querySelector('.user-info-modal').style.display = "none"
                })
            
    
               
                
            }
            
    
        })
       
    
    })

    window.addEventListener('click', e => {
        if(e.target.classList == 'user-info-modal'){
         document.querySelector('.user-info-modal').style.display = "none"
        }
    })
}
showUserInfo()




